(function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e,t){Z[$]=e,Z[$+1]=t,$+=2,2===$&&L()}function i(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(c)}}function o(){return function(){D(c)}}function s(){var e=0,t=new G(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function u(){var e=new MessageChannel;return e.port1.onmessage=c,function(){e.port2.postMessage(0)}}function a(){return function(){setTimeout(c,1)}}function c(){for(var e=0;$>e;e+=2){var t=Z[e],n=Z[e+1];t(n),Z[e]=void 0,Z[e+1]=void 0}$=0}function f(){try{var e=require,t=e("vertx");return D=t.runOnLoop||t.runOnContext,o()}catch(n){return a()}}function l(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return W.error=t,W}}function d(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function m(e,t,n){z(function(e){var r=!1,i=d(n,t,function(n){r||(r=!0,t!==n?b(e,n):w(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,E(e,i))},e)}function v(e,t){t._state===J?w(e,t._result):t._state===Y?E(e,t._result):S(t,void 0,function(t){b(e,t)},function(t){E(e,t)})}function y(e,n){if(n.constructor===e.constructor)v(e,n);else{var r=g(n);r===W?E(e,W.error):void 0===r?w(e,n):t(r)?m(e,n,r):w(e,n)}}function b(t,n){t===n?E(t,p()):e(n)?y(t,n):w(t,n)}function _(e){e._onerror&&e._onerror(e._result),P(e)}function w(e,t){e._state===X&&(e._result=t,e._state=J,0!==e._subscribers.length&&z(P,e))}function E(e,t){e._state===X&&(e._state=Y,e._result=t,z(_,e))}function S(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+J]=n,i[o+Y]=r,0===o&&e._state&&z(P,e)}function P(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?N(n,r,i,o):i(o);e._subscribers.length=0}}function x(){this.error=null}function k(e,t){try{return e(t)}catch(n){return ee.error=n,ee}}function N(e,n,r,i){var o,s,u,a,c=t(r);if(c){if(o=k(r,i),o===ee?(a=!0,s=o.error,o=null):u=!0,n===o)return void E(n,h())}else o=i,u=!0;n._state!==X||(c&&u?b(n,o):a?E(n,s):e===J?w(n,o):e===Y&&E(n,o))}function T(e,t){try{t(function(t){b(e,t)},function(t){E(e,t)})}catch(n){E(e,n)}}function q(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(l),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?w(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&w(n.promise,n._result))):E(n.promise,n._validationError())}function R(e){return new te(this,e).promise}function C(e){function t(e){b(i,e)}function n(e){E(i,e)}var r=this,i=new r(l);if(!Q(e))return E(i,new TypeError("You must pass an array to race.")),i;for(var o=e.length,s=0;i._state===X&&o>s;s++)S(r.resolve(e[s]),void 0,t,n);return i}function M(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(l);return b(n,e),n}function U(e){var t=this,n=new t(l);return E(n,e),n}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function A(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function I(e){this._id=se++,this._state=void 0,this._result=void 0,this._subscribers=[],l!==e&&(t(e)||O(),this instanceof I||A(),T(this,e))}function j(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=ue)}var F;F=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var D,L,Q=F,$=0,z=({}.toString,r),K="undefined"!=typeof window?window:void 0,B=K||{},G=B.MutationObserver||B.WebKitMutationObserver,V="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),H="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3);L=V?i():G?s():H?u():void 0===K&&"function"==typeof require?f():a();var X=void 0,J=1,Y=2,W=new x,ee=new x;q.prototype._validateInput=function(e){return Q(e)},q.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},q.prototype._init=function(){this._result=new Array(this.length)};var te=q;q.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,i=0;n._state===X&&t>i;i++)e._eachEntry(r[i],i)},q.prototype._eachEntry=function(e,t){var r=this,i=r._instanceConstructor;n(e)?e.constructor===i&&e._state!==X?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(i.resolve(e),t):(r._remaining--,r._result[t]=e)},q.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===X&&(r._remaining--,e===Y?E(i,n):r._result[t]=n),0===r._remaining&&w(i,r._result)},q.prototype._willSettleAt=function(e,t){var n=this;S(e,void 0,function(e){n._settledAt(J,t,e)},function(e){n._settledAt(Y,t,e)})};var ne=R,re=C,ie=M,oe=U,se=0,ue=I;I.all=ne,I.race=re,I.resolve=ie,I.reject=oe,I.prototype={constructor:I,then:function(e,t){var n=this,r=n._state;if(r===J&&!e||r===Y&&!t)return this;var i=new this.constructor(l),o=n._result;if(r){var s=arguments[r-1];z(function(){N(r,i,s,o)})}else S(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var ae=j,ce={Promise:ue,polyfill:ae};"function"==typeof define&&define.amd?define(function(){return ce}):"undefined"!=typeof module&&module.exports?module.exports=ce:"undefined"!=typeof this&&(this.ES6Promise=ce),ae()}).call(this),function(e,t){"use strict";"function"==typeof define&&define.amd?define("stackframe",[],t):"object"==typeof exports?module.exports=t():e.StackFrame=t()}(this,function(){"use strict";function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e,t,n,r,i){void 0!==e&&this.setFunctionName(e),void 0!==t&&this.setArgs(t),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==i&&this.setColumnNumber(i)}return t.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(e){this.functionName=String(e)},getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getFileName:function(){return this.fileName},setFileName:function(e){this.fileName=String(e)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(t){if(!e(t))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(t)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(t){if(!e(t))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(t)},toString:function(){var t=this.getFunctionName()||"{anonymous}",n="("+(this.getArgs()||[]).join(",")+")",r=this.getFileName()?"@"+this.getFileName():"",i=e(this.getLineNumber())?":"+this.getLineNumber():"",o=e(this.getColumnNumber())?":"+this.getColumnNumber():"";return t+n+r+i+o}},t}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("error-stack-parser",["stackframe"],t):"object"==typeof exports?module.exports=t(require("stackframe")):e.ErrorStackParser=t(e.StackFrame)}(this,function(e){"use strict";var t=/\S+\:\d+/,n=/\s+at /;return{parse:function(e){if("undefined"!=typeof e.stacktrace||"undefined"!=typeof e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack&&e.stack.match(t))return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){var t=e.split(":"),n=t.pop(),r=t[t.length-1];if(!isNaN(parseFloat(r))&&isFinite(r)){var i=t.pop();return[t.join(":"),i,n]}return[t.join(":"),n,void 0]},parseV8OrIE:function(t){return t.stack.split("\n").slice(1).map(function(t){var n=t.replace(/^\s+/,"").split(/\s+/).slice(1),r=this.extractLocation(n.pop().replace(/[\(\)\s]/g,"")),i=n[0]&&"Anonymous"!==n[0]?n[0]:void 0;return new e(i,void 0,r[0],r[1],r[2])},this)},parseFFOrSafari:function(n){return n.stack.split("\n").filter(function(e){return!!e.match(t)},this).map(function(t){var n=t.split("@"),r=this.extractLocation(n.pop()),i=n.shift()||void 0;return new e(i,void 0,r[0],r[1],r[2])},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],o=2,s=r.length;s>o;o+=2){var u=n.exec(r[o]);u&&i.push(new e(void 0,void 0,u[2],u[1]))}return i},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],o=0,s=r.length;s>o;o+=2){var u=n.exec(r[o]);u&&i.push(new e(u[3]||void 0,void 0,u[2],u[1]))}return i},parseOpera11:function(n){return n.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var n,r=t.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;o.match(/\(([^\)]*)\)/)&&(n=o.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var u=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e(s,u,i[0],i[1],i[2])},this)}}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("stack-generator",["stackframe"],t):"object"==typeof exports?module.exports=t(require("stackframe")):e.StackGenerator=t(e.StackFrame)}(this,function(e){return{backtrace:function(t){var n=[],r=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(r=t.maxStackSize);for(var i=arguments.callee;i&&n.length<r;){var o=[].slice.call(i.arguments);n.push(/function(?:\s+([\w$]+))?\s*\(/.test(i.toString())?new e(RegExp.$1||void 0,o):new e(void 0,o));try{i=i.caller}catch(s){break}}return n}}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("stacktrace-gps",["source-map","es6-promise","stackframe"],t):"object"==typeof exports?module.exports=t(require("source-map/lib/source-map/source-map-consumer"),require("es6-promise"),require("stackframe")):e.StackTraceGPS=t(e.SourceMap,e.ES6Promise,e.StackFrame)}(this,function(e,t){"use strict";function n(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=0;r<t.length;r++)try{return e=t[r](),n=t[r],e}catch(i){}}function r(e,t,r){var i=n();i.open("get",e),i.onerror=r,i.onreadystatechange=function(){if(4===i.readyState){if(i.status>=200&&i.status<400)return t(i.responseText);r(new Error("Unable to retrieve "+e))}},i.send()}function i(e,t,n){for(var r,i,o,s=/function\s+([^(]*?)\s*\(([^)]*)\)/,u=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,c=e.split("\n"),f="",l=Math.min(t,20),p=0;l>p;++p)if(r=c[t-p-1],o=r.indexOf("//"),o>=0&&(r=r.substr(0,o)),r){if(f=r+f,i=u.exec(f),i&&i[1])return i[1];if(i=s.exec(f),i&&i[1])return i[1];if(i=a.exec(f),i&&i[1])return i[1]}return void 0}function o(){if("function"!=typeof Object.defineProperty||"function"!=typeof Object.create)throw new Error("Unable to consume source maps in older browsers")}function s(e){if("object"!=typeof e)throw new TypeError("Given StackFrame is not an object");if("string"!=typeof e.fileName)throw new TypeError("Given file name is not a String");if("number"!=typeof e.lineNumber||e.lineNumber%1!==0||e.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if("number"!=typeof e.columnNumber||e.columnNumber%1!==0||e.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function u(e){var t=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)$/.exec(e);if(t&&t[1])return t[1];throw new Error("sourceMappingURL not found")}function a(t,n,r,i){var o=new e.SourceMapConsumer(t).originalPositionFor({line:r,column:i});return new StackFrame(o.name,n,o.source,o.line,o.column)}t.polyfill();var c=t.Promise;return function f(e){return this instanceof f?(e=e||{},this.sourceCache=e.sourceCache||{},this._get=function(t){return new c(function(n,i){this.sourceCache[t]?n(this.sourceCache[t]):e.offline?i(new Error("Cannot make network requests in offline mode")):r(t,function(e){this.sourceCache[t]=e,n(e)}.bind(this),i)}.bind(this))},this.pinpoint=function(e){return this.getMappedLocation(e).then(this.findFunctionName.bind(this))},this.findFunctionName=function(e){return new c(function(t,n){s(e),this._get(e.fileName).then(function(n){var r=i(n,e.lineNumber,e.columnNumber);t(new StackFrame(r,e.args,e.fileName,e.lineNumber,e.columnNumber))},n)}.bind(this))},void(this.getMappedLocation=function(e){return new c(function(t,n){o(),s(e),this._get(e.fileName).then(function(r){this._get(u(r)).then(function(n){var r=e.lineNumber,i=e.columnNumber;t(a(n,e.args,r,i))},n)["catch"](n)}.bind(this),n)["catch"](n)}.bind(this))})):new f(e)}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("stacktrace",["error-stack-parser","stack-generator","stacktrace-gps","es6-promise"],t):"object"==typeof exports?module.exports=t(require("error-stack-parser"),require("stack-generator"),require("stacktrace-gps"),require("es6-promise")):e.StackTrace=t(e.ErrorStackParser,e.StackGenerator,e.StackTraceGPS,e.ES6Promise)}(this,function(e,t,n,r){function i(e,t){var n={};return[e,t].forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}),n}function o(e){return e.stack||e["opera#sourceloc"]}r.polyfill();var s=r.Promise,u={filter:function(e){return-1===(e.functionName||"").indexOf("StackTrace$$")&&-1===(e.functionName||"").indexOf("ErrorStackParser$$")&&-1===(e.functionName||"").indexOf("StackTraceGPS$$")&&-1===(e.functionName||"").indexOf("StackGenerator$$")}};return{get:function(e){try{throw new Error}catch(t){return o(t)?this.fromError(t,e):this.generateArtificially(e)}},fromError:function(t,r){return r=i(u,r),new s(function(i){var o=e.parse(t);"function"==typeof r.filter&&(o=o.filter(r.filter)),i(s.all(o.map(function(e){return new s(function(t){function i(n){t(e)}new n(r).pinpoint(e).then(t,i)["catch"](i)})})))}.bind(this))},generateArtificially:function(e){e=i(u,e);var n=t.backtrace(e);return"function"==typeof e.filter&&(n=n.filter(e.filter)),s.resolve(n)},instrument:function(e,t,n,r){if("function"!=typeof e)throw new Error("Cannot instrument non-function object");if("function"==typeof e.__stacktraceOriginalFn)return e;var i=function(){try{this.get().then(t,n)["catch"](n),e.apply(r||this,arguments)}catch(i){throw o(i)&&this.fromError(i).then(t,n)["catch"](n),i}}.bind(this);return i.__stacktraceOriginalFn=e,i},deinstrument:function(e){if("function"!=typeof e)throw new Error("Cannot de-instrument non-function object");return"function"==typeof e.__stacktraceOriginalFn?e.__stacktraceOriginalFn:e}}}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.Exceptionless=t()}(this,function(e,t,n){function r(){if(!document||!document.getElementsByTagName)return null;for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].src&&e[t].src.indexOf("/exceptionless")>-1)return p.parseQueryString(e[t].src.split("?").pop());return null}function i(){if(window&&window.onerror){var e=window.onerror;window.onerror=function(t,n,r,i,o){var s=y["default"];if(null!==o&&"object"==typeof o)s.submitUnhandledException(o);else{var u={message:t,stack_trace:[{file_name:n,line_number:r,column:i}]};s.createUnhandledException(new Error(t)).setMessage(t).setProperty("@error",u).submit()}if(e)try{return e(t,n,r,i,o)}catch(u){s.config.log.error("An error occurred while calling previous error handler: "+u.message)}return!1}}}var o=function(){function e(){this._lastReferenceId=null}return e.prototype.getLast=function(){return this._lastReferenceId},e.prototype.clearLast=function(){this._lastReferenceId=null},e.prototype.setLast=function(e){this._lastReferenceId=e},e}();t.InMemoryLastReferenceIdManager=o;var s=function(){function e(){}return e.prototype.info=function(e){},e.prototype.warn=function(e){},e.prototype.error=function(e){},e}();t.NullLog=s;var u=function(){function e(e,t,n){this.cancel=!1,this.client=e,this.event=t,this.contextData=n?n:new m}return Object.defineProperty(e.prototype,"log",{get:function(){return this.client.config.log},enumerable:!0,configurable:!0}),e}();t.EventPluginContext=u;var a=function(){function e(){}return e.run=function(e){return e.client.config.plugins.reduce(function(t,n){return t.then(function(){return n.run(e)})},Promise.resolve())},e.addDefaultPlugins=function(e){e.addPlugin(new b),e.addPlugin(new _),e.addPlugin(new w),e.addPlugin(new E),e.addPlugin(new S),e.addPlugin(new P)},e}();t.EventPluginManager=a;var c=function(){function e(){this.priority=20,this.name="ReferenceIdPlugin"}return e.prototype.run=function(e){return e.event.reference_id&&0!==e.event.reference_id.length||"error"!==e.event.type||(e.event.reference_id=p.guid().replace("-","").substring(0,10)),Promise.resolve()},e}();t.ReferenceIdPlugin=c;var f=function(){function e(e){this._processingQueue=!1,this._config=e}return e.prototype.enqueue=function(e){if(this.ensureQueueTimer(),this.areQueuedItemsDiscarded())return void this._config.log.info("Queue items are currently being discarded. The event will not be queued.");var t=this.queuePath()+"-"+(new Date).toJSON()+"-"+p.randomNumber();return this._config.log.info("Enqueuing event: "+t),this._config.storage.save(t,e)},e.prototype.process=function(){var e=this;if(this.ensureQueueTimer(),!this._processingQueue){if(this._config.log.info("Processing queue..."),!this._config.enabled)return void this._config.log.info("Configuration is disabled. The queue will not be processed.");this._processingQueue=!0;try{var t=this._config.storage.get(this.queuePath(),this._config.submissionBatchSize);if(!t||0==t.length)return void this._config.log.info("There are currently no queued events to process.");this._config.log.info("Sending "+t.length+" events to "+this._config.serverUrl+"."),this._config.submissionClient.submit(t,this._config).then(function(n){return e.processSubmissionResponse(n,t)},function(n){return e.processSubmissionResponse(n,t)}).then(function(){e._config.log.info("Finished processing queue."),e._processingQueue=!1})}catch(n){this._config.log.error("An error occurred while processing the queue: "+n),this.suspendProcessing(),this._processingQueue=!1}}},e.prototype.processSubmissionResponse=function(e,t){return e.success?void this._config.log.info("Sent "+t.length+" events to "+this._config.serverUrl+"."):e.serviceUnavailable?(this._config.log.error("Server returned service unavailable."),this.suspendProcessing(),void this.requeueEvents(t)):e.paymentRequired?(this._config.log.info("Too many events have been submitted, please upgrade your plan."),void this.suspendProcessing(null,!0,!0)):e.unableToAuthenticate?(this._config.log.info("Unable to authenticate, please check your configuration. The event will not be submitted."),void this.suspendProcessing(15)):e.notFound||e.badRequest?(this._config.log.error("Error while trying to submit data: "+e.message),void this.suspendProcessing(240)):e.requestEntityTooLarge?void(this._config.submissionBatchSize>1?(this._config.log.error("Event submission discarded for being too large. The event will be retried with a smaller events size."),this._config.submissionBatchSize=Math.max(1,Math.round(this._config.submissionBatchSize/1.5)),this.requeueEvents(t)):this._config.log.error("Event submission discarded for being too large. The event will not be submitted.")):void(e.success||(this._config.log.error("An error occurred while submitting events: "+e.message),this.suspendProcessing(),this.requeueEvents(t)))},e.prototype.ensureQueueTimer=function(){var e=this;this._queueTimer||(this._queueTimer=setInterval(function(){return e.onProcessQueue()},1e4))},e.prototype.onProcessQueue=function(){this.isQueueProcessingSuspended()||this._processingQueue||this.process()},e.prototype.suspendProcessing=function(e,t,n){if((!e||0>=e)&&(e=5),this._config.log.info("Suspending processing for "+e+" minutes."),this._suspendProcessingUntil=new Date((new Date).getTime()+6e4*e),t&&(this._discardQueuedItemsUntil=new Date((new Date).getTime()+6e4*e)),n)try{this._config.storage.clear(this.queuePath())}catch(r){}},e.prototype.requeueEvents=function(e){this._config.log.info("Requeuing "+e.length+" events.");for(var t=0;t<e.length;t++)this.enqueue(e[t])},e.prototype.isQueueProcessingSuspended=function(){return this._suspendProcessingUntil&&this._suspendProcessingUntil>new Date},e.prototype.areQueuedItemsDiscarded=function(){return this._discardQueuedItemsUntil&&this._discardQueuedItemsUntil>new Date},e.prototype.queuePath=function(){return this._config.apiKey?"ex-"+this._config.apiKey.slice(0,8)+"-q":null},e}();t.DefaultEventQueue=f;var l=function(){function e(){this._items={}}return e.prototype.save=function(e,t){return this._items[e]=t,!0},e.prototype.get=function(e,t){var n=[],r=new RegExp(e||".*");for(var i in this._items){if(n.length>=t)break;r.test(i)&&(n.push(this._items[i]),delete this._items[i])}return n},e.prototype.clear=function(e){if(!e)return void(this._items={});var t=new RegExp(e);for(var n in this._items)t.test(n)&&delete this._items[n]},e.prototype.count=function(e){var t=new RegExp(e||".*"),n=[];for(var r in this._items)t.test(r)&&n.push(r);return n.length},e}();t.InMemoryStorage=l;var p=function(){function e(){}return e.getHashCode=function(e){if(!e||0===e.length)return null;for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t|=0}return t.toString()},e.guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.merge=function(e,t){var n={};for(var r in e||{})e[r]&&(n[r]=e[r]);for(var r in t||{})t[r]&&(n[r]=t[r]);return n},e.parseVersion=function(e){if(!e)return null;var t=/(v?((\d+)\.(\d+)(\.(\d+))?)(?:-([\dA-Za-z\-]+(?:\.[\dA-Za-z\-]+)*))?(?:\+([\dA-Za-z\-]+(?:\.[\dA-Za-z\-]+)*))?)/,n=t.exec(e);return n&&n.length>0?n[0]:null},e.parseQueryString=function(e){if(!e||0===e.length)return null;var t=e.split("&");if(0===t.length)return null;for(var n={},r=0;r<t.length;r++){var i=t[r].split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return n},e.randomNumber=function(){return Math.floor(9007199254740992*Math.random())},e.stringify=function(e){var t=[];return JSON.stringify(e,function(e,n){if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n})},e}();t.Utils=p;var h=function(){function e(t){function n(e){return"function"==typeof e?e(this):e}this._enabled=!1,this._serverUrl="https://collector.exceptionless.io",this._plugins=[],this.lastReferenceIdManager=new o,this.defaultTags=[],this.defaultData={},t=p.merge(e.defaults,t),this.apiKey=t.apiKey,this.serverUrl=t.serverUrl,this.lastReferenceIdManager=n(t.lastReferenceIdManager)||new o,this.log=n(t.log)||new s,this.submissionBatchSize=n(t.submissionBatchSize)||50,this.submissionClient=n(t.submissionClient),this.storage=n(t.storage)||new l,this.queue=n(t.queue)||new f(this),a.addDefaultPlugins(this)}return Object.defineProperty(e.prototype,"apiKey",{get:function(){return this._apiKey},set:function(e){this._apiKey=e||null,this._enabled=!!e&&e.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"serverUrl",{get:function(){return this._serverUrl},set:function(e){e&&e.length>0&&(this._serverUrl=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plugins",{get:function(){return this._plugins.sort(function(e,t){return e.priority<t.priority?-1:e.priority>t.priority?1:0})},enumerable:!0,configurable:!0}),e.prototype.addPlugin=function(e,t,n){var r=n?{name:e,priority:t,run:n}:e;if(!r||!r.run)return void this.log.error("Unable to add plugin: No run method was found.");r.name||(r.name=p.guid()),r.priority||(r.priority=0);for(var i=!1,o=0;o<this._plugins.length;o++)if(this._plugins[o].name===r.name){i=!0;break}i||this._plugins.push(r)},e.prototype.removePlugin=function(e){var t="string"==typeof e?e:e.name;if(!t)return void this.log.error("Unable to remove plugin: No plugin name was specified.");for(var n=0;n<this._plugins.length;n++)if(this._plugins[n].name===t){this._plugins.splice(n,1);break}},e.prototype.useReferenceIds=function(){this.addPlugin(new c)},Object.defineProperty(e,"defaults",{get:function(){return null===e._defaultSettings&&(e._defaultSettings={}),e._defaultSettings},enumerable:!0,configurable:!0}),e._defaultSettings=null,e}();t.Configuration=h;var g=function(){function e(e,t,n,r,i){void 0===n&&(n=-1),void 0===r&&(r=null),void 0===i&&(i=null),this.success=!1,this.settingsVersion=-1,this.success=e,this.settings=t,this.settingsVersion=n,this.exception=r,this.message=i}return e}();t.SettingsResponse=g;var d=function(){function e(e,t){this.success=!1,this.badRequest=!1,this.serviceUnavailable=!1,this.paymentRequired=!1,this.unableToAuthenticate=!1,this.notFound=!1,this.requestEntityTooLarge=!1,this.statusCode=e,this.message=t,this.success=e>=200&&299>=e,this.badRequest=400===e,this.serviceUnavailable=503===e,this.paymentRequired=402===e,this.unableToAuthenticate=401===e||403===e,this.notFound=404===e,this.requestEntityTooLarge=413===e}return e}();t.SubmissionResponse=d;var m=function(){function e(){}return e.prototype.setException=function(e){this["@@_Exception"]=e},Object.defineProperty(e.prototype,"hasException",{get:function(){return!!this["@@_Exception"]},enumerable:!0,configurable:!0}),e.prototype.getException=function(){return this.hasException?this["@@_Exception"]:null},e.prototype.markAsUnhandledError=function(){this["@@_IsUnhandledError"]=!0},Object.defineProperty(e.prototype,"isUnhandledError",{get:function(){return!!this["@@_IsUnhandledError"]},enumerable:!0,configurable:!0}),e.prototype.setSubmissionMethod=function(e){this["@@_SubmissionMethod"]=e},e.prototype.getSubmissionMethod=function(){return this["@@_SubmissionMethod"]?null:this["@@_SubmissionMethod"]},e}();t.ContextData=m;var v=function(){function e(e,t,n){this.target=e,this.client=t,this.pluginContextData=n}return e.prototype.setType=function(e){return e&&e.length>0&&(this.target.type=e),this},e.prototype.setSource=function(e){return e&&e.length>0&&(this.target.source=e),this},e.prototype.setSessionId=function(e){if(!this.isValidIdentifier(e))throw new Error("SessionId must contain between 8 and 100 alphanumeric or '-' characters.");return this.target.session_id=e,this},e.prototype.setReferenceId=function(e){if(!this.isValidIdentifier(e))throw new Error("SessionId must contain between 8 and 100 alphanumeric or '-' characters.");return this.target.reference_id=e,this},e.prototype.setMessage=function(e){return e&&e.length>0&&(this.target.message=e),this},e.prototype.setGeo=function(e,t){if(-90>e||e>90)throw new Error("Must be a valid latitude value between -90.0 and 90.0.");if(-180>t||t>180)throw new Error("Must be a valid longitude value between -180.0 and 180.0.");return this.target.geo=e+","+t,this},e.prototype.setValue=function(e){return e&&(this.target.value=e),this},e.prototype.addTags=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(!e||0===e.length)return this;this.target.tags||(this.target.tags=[]);for(var n=0;n<e.length;n++)e[n]&&this.target.tags.indexOf(e[n])<0&&this.target.tags.push(e[n]);return this},e.prototype.setProperty=function(e,t){return e&&void 0!==t&&null!=t?(this.target.data||(this.target.data={}),this.target.data[e]=t,this):this},e.prototype.markAsCritical=function(e){return e&&this.addTags("Critical"),this},e.prototype.submit=function(){return this.client.submitEvent(this.target,this.pluginContextData)},e.prototype.isValidIdentifier=function(e){if(!e||!e.length)return!0;if(e.length<8||e.length>100)return!1;for(var t=0;t<e.length;t++){var n=e.charCodeAt(t),r=n>=48&&57>=n,i=n>=65&&90>=n||n>=97&&122>=n,o=45===n;if(!r&&!i&&!o)return!1}return!0},e}();t.EventBuilder=v;var y=function(){function e(e,t){this.config=new h("object"!=typeof e?e:{apiKey:e,serverUrl:t})}return e.prototype.createException=function(e){var t=new m;return t.setException(e),this.createEvent(t).setType("error")},e.prototype.submitException=function(e){return this.createException(e).submit()},e.prototype.createUnhandledException=function(e){var t=this.createException(e);return t.pluginContextData.markAsUnhandledError(),t},e.prototype.submitUnhandledException=function(e){return this.createUnhandledException(e).submit()},e.prototype.createFeatureUsage=function(e){return this.createEvent().setType("usage").setSource(e)},e.prototype.submitFeatureUsage=function(e){return this.createFeatureUsage(e).submit()},e.prototype.createLog=function(e,t,n){var r=this.createEvent().setType("log");if(e&&t&&n)r=r.setSource(e).setMessage(t).setProperty("@level",n);else if(e&&t)r=r.setSource(e).setMessage(t);else{var i=arguments.callee.caller.name;r=r.setSource(i).setMessage(e)}return r},e.prototype.submitLog=function(e,t,n){return this.createLog(e,t,n).submit()},e.prototype.createNotFound=function(e){return this.createEvent().setType("404").setSource(e)},e.prototype.submitNotFound=function(e){return this.createNotFound(e).submit()},e.prototype.createSessionStart=function(e){return this.createEvent().setType("start").setSessionId(e)},e.prototype.submitSessionStart=function(e){return this.createSessionStart(e).submit()},e.prototype.createSessionEnd=function(e){return this.createEvent().setType("end").setSessionId(e)},e.prototype.submitSessionEnd=function(e){return this.createSessionEnd(e).submit()},e.prototype.createEvent=function(e){return new v({date:new Date},this,e)},e.prototype.submitEvent=function(e,t){var n=this;if(!e)return Promise.reject(new Error("Unable to submit undefined event."));if(!this.config.enabled){var r="Event submission is currently disabled.";return this.config.log.info(r),Promise.reject(new Error(r))}var i=new u(this,e,t);return a.run(i).then(function(){if(i.cancel){var t='Event submission cancelled by plugin": id='+e.reference_id+" type="+e.type;return n.config.log.info(t),Promise.reject(new Error(t))}return e.type&&0!==e.type.length||(e.type="log"),e.date||(e.date=new Date),n.config.log.info("Submitting event: type="+e.type+" "+(e.reference_id?"refid="+e.reference_id:"")),n.config.queue.enqueue(e),e.reference_id&&e.reference_id.length>0&&(n.config.log.info('Setting last reference id "'+e.reference_id+'"'),n.config.lastReferenceIdManager.setLast(e.reference_id)),Promise.resolve()})["catch"](function(e){var t="Event submission cancelled. An error occurred while running the plugins: "+(e&&e.message?e.message:e);return n.config.log.error(t),Promise.reject(new Error(t))})},e.prototype.getLastReferenceId=function(){return this.config.lastReferenceIdManager.getLast()},Object.defineProperty(e,"default",{get:function(){return null===e._instance&&(e._instance=new e(null)),e._instance},enumerable:!0,configurable:!0}),e._instance=null,e}();t.ExceptionlessClient=y;var b=function(){function e(){this.priority=10,this.name="ConfigurationDefaultsPlugin"}return e.prototype.run=function(e){if(e.client.config.defaultTags){e.event.tags||(e.event.tags=[]);for(var t=0;t<e.client.config.defaultTags.length;t++){
var n=e.client.config.defaultTags[t];n&&e.client.config.defaultTags.indexOf(n)<0&&e.event.tags.push(n)}}if(e.client.config.defaultData){e.event.data||(e.event.data={});for(var r in e.client.config.defaultData)e.client.config.defaultData[r]&&(e.event.data[r]=e.client.config.defaultData[r])}return Promise.resolve()},e}();t.ConfigurationDefaultsPlugin=b;var _=function(){function e(){this.priority=30,this.name="ErrorPlugin"}return e.prototype.run=function(e){var t=this,n=e.contextData.getException();return null==n?Promise.resolve():(e.event.data||(e.event.data={}),e.event.type="error",e.event.data["@error"]?Promise.resolve():StackTrace.fromError(n).then(function(r){return t.processError(e,n,r)},function(){return t.onParseError(e)}))},e.prototype.processError=function(e,t,n){var r={message:t.message,stack_trace:this.getStackFrames(e,n||[])};return e.event.data["@error"]=r,Promise.resolve()},e.prototype.onParseError=function(e){return e.cancel=!0,Promise.reject(new Error("Unable to parse the exceptions stack trace. This exception will be discarded."))},e.prototype.getStackFrames=function(e,t){for(var n=[],r=0;r<t.length;r++)n.push({name:t[r].functionName,file_name:t[r].fileName,line_number:t[r].lineNumber,column:t[r].columnNumber});return n},e}();t.ErrorPlugin=_;var w=function(){function e(){this.priority=50,this.name="DuplicateCheckerPlugin"}return e.prototype.run=function(e){return Promise.resolve()},e}();t.DuplicateCheckerPlugin=w;var E=function(){function e(){this.priority=40,this.name="ModuleInfoPlugin"}return e.prototype.run=function(e){if(!e.event.data||!e.event.data["@error"]||e.event.data["@error"].modules)return Promise.resolve();try{if(document&&document.getElementsByTagName){var t=this.getFromDocument();t&&t.length>0&&(e.event.data["@error"].modules=t)}}catch(n){e.log.error("Unable to get module info. Exception: "+n.message)}return Promise.resolve()},e.prototype.getFromDocument=function(){var e=[],t=document.getElementsByTagName("script");if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].src?e.push({module_id:n,name:t[n].src,version:p.parseVersion(t[n].src)}):t[n].innerHTML&&e.push({module_id:n,name:"Script Tag",version:p.getHashCode(t[n].innerHTML)});return e},e}();t.ModuleInfoPlugin=E;var S=function(){function e(){this.priority=60,this.name="RequestInfoPlugin"}return e.prototype.run=function(e){if(e.event.data&&e.event.data["@request"])return Promise.resolve();e.event.data||(e.event.data={});var t={user_agent:navigator.userAgent,is_secure:"https:"===location.protocol,host:location.hostname,port:location.port&&""!==location.port?parseInt(location.port):80,path:location.pathname,cookies:this.getCookies(),query_string:p.parseQueryString(location.search.substring(1))};return document.referrer&&""!==document.referrer&&(t.referrer=document.referrer),e.event.data["@request"]=t,Promise.resolve()},e.prototype.getCookies=function(){if(!document.cookie)return null;for(var e={},t=document.cookie.split(", "),n=0;n<t.length;n++){var r=t[n].split("=");e[r[0]]=r[1]}return e},e}();t.RequestInfoPlugin=S;var P=function(){function e(){this.priority=100,this.name="SubmissionMethodPlugin"}return e.prototype.run=function(e){var t=e.contextData.getSubmissionMethod();return t&&(e.event.data||(e.event.data={}),e.event.data["@submission_method"]=t),Promise.resolve()},e}();t.SubmissionMethodPlugin=P;var x=function(){function e(){}return e.prototype.info=function(e){console&&console.log&&console.log("[INFO] Exceptionless:"+e)},e.prototype.warn=function(e){console&&console.log&&console.log("[Warn] Exceptionless:"+e)},e.prototype.error=function(e){console&&console.log&&console.log("[Error] Exceptionless:"+e)},e}();t.ConsoleLog=x;var k=function(){function e(){}return e.prototype.submit=function(e,t){var n=this,r=t.serverUrl+"/api/v2/events?access_token="+encodeURIComponent(t.apiKey);return this.sendRequest("POST",r,p.stringify(e)).then(function(e){return new d(e.status,n.getResponseMessage(e))},function(e){return new d(e.status||500,n.getResponseMessage(e))})},e.prototype.submitDescription=function(e,t,n){var r=this,i=n.serverUrl+"/api/v2/events/by-ref/"+encodeURIComponent(e)+"/user-description?access_token="+encodeURIComponent(n.apiKey);return this.sendRequest("POST",i,p.stringify(t)).then(function(e){return new d(e.status,r.getResponseMessage(e))},function(e){return new d(e.status||500,r.getResponseMessage(e))})},e.prototype.getSettings=function(e){var t=this,n=e.serverUrl+"/api/v2/projects/config?access_token="+encodeURIComponent(e.apiKey);return this.sendRequest("GET",n).then(function(n){if(200!==n.status)return new g(!1,null,-1,null,"Unable to retrieve configuration settings: "+t.getResponseMessage(n));var r;try{r=JSON.parse(n.responseText)}catch(i){e.log.error('An error occurred while parsing the settings response text: "'+n.responseText+'"')}return r&&r.settings&&r.version?new g(!0,r.settings,r.version):new g(!0,null,-1,null,"Invalid configuration settings.")},function(e){return new g(!1,null,-1,null,t.getResponseMessage(e))})},e.prototype.getResponseMessage=function(e){if(!e||e.status>=200&&e.status<=299)return null;if(0===e.status)return"Unable to connect to server.";if(e.responseBody)return e.responseBody.message;if(e.responseText)try{return JSON.parse(e.responseText).message}catch(t){return e.responseText}return e.statusText},e.prototype.createRequest=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n&&("POST"===e&&n.setRequestHeader&&n.setRequestHeader("Content-Type","application/json"),n.timeout=1e4),n},e.prototype.sendRequest=function(e,t,n){var r=this.createRequest(e||"POST",t);return new Promise(function(e,t){return r?("withCredentials"in r&&(r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<=299?e(r):t(r))}),r.ontimeout=function(){return t(r)},r.onerror=function(){return t(r)},r.onload=function(){return e(r)},void r.send(n)):t({status:503,message:"CORS not supported."})})},e}();t.DefaultSubmissionClient=k;var N=r();return N&&(N.apiKey||N.serverUrl)&&(h.defaults.apiKey=N.apiKey,h.defaults.serverUrl=N.serverUrl),h.defaults.submissionClient=new k,i(),{Exceptionless:t}});
//# sourceMappingURL=exceptionless.es5.min.js.map